# 不具合対応

:::info ページの説明
**ましゅまろ PB が正常に動作していない**と思われる場合に参照するページです。  
(正常に動作している場合は、[「使い方/応用編」](https://wataame89.github.io/documents-wataameya/marshmallowPB/howtouse/addition)、[「Q&A」](https://wataame89.github.io/documents-wataameya/marshmallowPB/qa)を参照)
:::

### 服が貫通してしまう場合

ましゅまろ PB は仕様上、服によってはどうしても貫通してしまいます。以下のような対策があります。

- **VRC 上でましゅまろ PB の機能を制限する。**
  - Ex メニューから、ましゅまろ PB のつぶれオフ、通常 PB に変更、ましゅまろ PB オフが可能です。
  - 毎回選択する必要はありますが、ましゅまろ PB 由来の貫通は無くなります。
- **身体メッシュの胸シェイプキーを僅かに小さくする。**
  - 身体メッシュの胸の大きさのシェイプキーを服のシェイプキーに対して僅かに小さく設定します。(例:胸 90、服 100)
  - 多くの場合で効果的です。
- **Inertia、ParallelBone の効果を小さくする。**
  - Inertia の Immobile を 1、ParallelBone の平行度を 0 に近づけると、各システムの効果が小さくなります。
  - 縦に揺れた際に貫通する場合に効果的です。
- **胸ボーンの角度を制限する。**
  - PhysBone Setting の「[LimitAngle(角度制限)](https://wataame89.github.io/documents-wataameya/marshmallowPB/howtouse/setup)」の数値を小さくする。
  - 大きく揺れた際に貫通する場合に効果的です。
- **胸のつぶれ深さを浅くする。**
  - Anti-Penetration Setting(貫通防止設定)の「[つぶれ制限コライダーの位置](https://wataame89.github.io/documents-wataameya/marshmallowPB/howtouse/setup)」の数値を大きくする。
    - PhysBone Setting の「[MaxSquish](https://wataame89.github.io/documents-wataameya/marshmallowPB/howtouse/setup)」の数値を小さくする(通常時のつぶれ具合)。
    - Gravity Setting(重力機能)の「[つぶれやすさ](https://wataame89.github.io/documents-wataameya/marshmallowPB/howtouse/setup)」の数値を小さくする(仰向けになったときのつぶれ具合)。
  - 「つぶれ制限コライダーの位置」は他の 2 つよりも優先的に作用するため、基本的にこのパラメータのみの変更で問題ありません。
  - 胸がつぶれた際に貫通する場合に効果的です。
- **胸のつぶれ機能をオフにする。**
  - 「[つぶれ機能オフ(貫通対策)](https://wataame89.github.io/documents-wataameya/marshmallowPB/howtouse/setup)」をオンにすることで設定できます。
  - VRC 上で Ex メニューからオンに変更もできます。
  - 胸がつぶれた際に貫通する場合に効果的です。
    - 完全に胸が変形しなくなるため、胸のつぶれ深さを浅くするよりも強力です。

### ましゅまろ PB が適用されない場合

Gesture Manager や再生モードに入っても marshmallow_PB_setup が残っている場合は何らかの理由でましゅまろ PB が適用されていません。

#### ウィンドウにメッセージが表示されている場合：

再度導入方法を確認し、メッセージに従って修正してください。

#### NDMF Console でエラーが発生している場合：

何らかの不具合により処理が中断されているため、そのコードをコピーして[Booth](https://wataame89.booth.pm)か[Twitter](https://twitter.com/wataameya_vr)に送ってください。  
ただし、**再生モードを解除した際に発生するエラーはましゅまろ PB のエラーとは関係がない**ので、再生モードに入ったときに NDMF コンソールに発生するエラーを送ってください。

#### NDMF Console でエラーが発生していない場合：

ウィンドウ上部の Tools→NDM Framework→Apply on Play にチェックが入っているかを確認してください。  
チェックが入っているのに動かない場合はもう一度エラーを確認した後、ご相談ください。

<!-- ### ブレが大きい場合
ましゅまろPBは押した際にブレが発生することがあります。基本的にブレはStiffness(変形しにくさ)を上げることで解消されます。

### エラーウィンドウが出た場合
大抵の場合、セットアップの設定が間違っているので導入方法の動画を参考に設定し直してください。 -->

### 胸ボーンが複数の構造になっている場合

胸ボーンが複数の構造になっている場合は、PB を全て削除し、最上段のボーンをましゅまろ PB に設定して下さい。  
複数の構造になっていても、最上段のみを動かすことで、1 つのボーンと同等となります。

### 移動時につぶれすぎる場合

「StretchMotion（伸縮のしやすさ）」の値を小さくすることによって、移動時につぶれにくくなります。

### 勝手に胸がつぶれてしまう場合

「他プレイヤーとの胸干渉」がオンになっている場合、この機能が何らかの不具合によって勝手に動作することで胸がつぶれてしまうことがあります。基本的には「他プレイヤーとの胸干渉」をオフにすることで解消されるはずです。

### つぶれアニメーションが動かない場合

アバターに FX レイヤーを入れていない場合、動かないことがあります。空のコントローラーを入れると動作します。

### ましゅまろ PB の揺れがおかしい場合

PB を複数持つアバターの場合、通常の設定では PB を削除しきれず、動きがおかしくなる場合があります(ヴェールなど)。この場合、「配下の PB を全削除」をオンにすると直ります。  
非対応アバターの場合、胸ボーンを操作しているコンポーネント(Physbone、Constraint)と干渉する場合があるので、可能な限り削除してから導入してください。胸ボーン下ではなく、アバター直下にコンポーネントがある場合もあるので、よく確認してください。

### ましゅまろ PB の設定位置がおかしい場合 (動くとメッシュが破綻する場合)

ましゅまろ PB の位置が何らかの理由でズレている可能性が考えられます。非対応アバターと同様に設定するか、「[オフセットとしてこのオブジェクトの Transform を使用](https://wataame89.github.io/documents-wataameya/marshmallowPB/howtouse/setup)」
をオンにしてオフセットを設定することで調整して下さい。

### アバターの胸部分が破綻する(ねじれる)

**アバターのアニメーションで胸ボーンを操作している場合**、破綻する場合があります。(ラシューシャ、ネフェリサなど)

FX レイヤーを空のものに差し替えると正常に動く場合、その可能性が高いです。  
胸ボーンを操作しているアニメーションを探し、削除すると正常に動作するはずです。

### 服の胸部分のみが破綻する(ねじれる)

VRCFury の Armature Link を使用している場合、服のみがねじれることがあります。  
ModularAvatar の着せ替え機能を使用してください。

---

### アバターごとの不具合

### 「しなの」 ： 胸の揺れがおかしい・左右で異なる

理由は不明ですが、削除されるはずの胸の PB が何故か残ってしまうことが原因です。
胸の PB を予め削除しておくことで、直るはずです。

### 「くろなつ」 ： ましゅまろ PB が動作しない

くろなつは胸のサイズが通常の場合、FX レイヤーのアニメーションから PB が動かないように設定されています。  
くろなつの FX レイヤーの「Breast_DB」を削除することで、動作するはずです。

### 「ルルネ」 ： AFK に入ると謎の物体が発生する

ルルネの AFK は Armature を圧縮しているため、ましゅまろ PB の Constraint と干渉し、メッシュが残ってしまいます。  
AFK アニメーションを地中に埋めることで対応できます。アニメーションの修正パッチは[こちら](https://drive.google.com/file/d/1GFAQwwUsCjFp7VGXelsKM6SXsQ75dpNT/view?usp=sharing)。

### 「ラシューシャ」 ： 胸がねじれる

ラシューシャは FX レイヤーのアニメーションから胸ボーンの位置が操作されているため、干渉して胸がねじれることがあります。  
この場合、「BreastPB Control」のレイヤーの Weight を 0 にするか、不要であれば削除すれば動作するはずです。

### 「ネフェリサ」 ： 胸がねじれる

ネフェリサは FX レイヤーのアニメーションから胸ボーンの位置が操作されているため、干渉して胸がねじれることがあります。  
この場合、「Bust Size」のレイヤーの Weight を 0 にするか、不要であれば削除すれば動作するはずです。

---

### 既知の不具合

### ましゅまろ PB を掴んだ際にコライダーの判定が消えない不具合

ましゅまろ PB を掴んだ際にコライダーの判定が消えなくなる現象です。  
引っ張るなどして、コライダーから離れると正常に判定が消えます。未確認ですが、 VRChat 側の不具合だと思われます。  
※ver2.0 現在では、機能自体を無効化しています。

---

:::caution このページで不具合が解決しない場合
[お問い合わせ](https://wataame89.github.io/documents-wataameya/marshmallowPB/howtocontact)を参照してください。
:::
